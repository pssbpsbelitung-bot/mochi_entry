<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entri Capaian Harian</title>
<style>
body { font-family: Arial; padding:15px; }
input, select { width:100%; padding:10px; margin:5px 0; font-size:16px; }
button { width:100%; padding:12px; font-size:16px; margin-top:10px; }
.card { background:#f4f4f4; padding:10px; margin-top:10px; border-radius:8px; }
h3 { margin-top:20px; }
</style>
</head>
<body>

<h2>Entri Capaian Harian</h2>

<label>PCL</label>
<select id="pclSelect"></select>

<label>Tanggal</label>
<input type="date" id="tanggal">

<label>Desa</label>
<select id="desaSelect"></select>

<label>BS</label>
<select id="bsSelect"></select>

<label>Jumlah Usaha Disensus</label>
<input type="number" id="jumlahUsaha">

<label>Jumlah Usaha Online</label>
<input type="number" id="jumlahOnline" onchange="generateOnlineForm()">

<div id="onlineContainer"></div>

<button onclick="submitData()">SIMPAN</button>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyVV9lD5jt6Tod1SLN7ZZekH9Y6URsWt0XTS-nMpCfdNG5YCF9UWvYB3yxyX_lu7C-S/exec";

let masterData = [];

// =======================
// LOAD MASTER (FINAL FIX)
// =======================
async function loadMaster(){
  try{
    const res = await fetch(WEB_APP_URL + "?type=master");
    const data = await res.json();

    if (!Array.isArray(data)) {
      console.error("Response error:", data);
      alert("Master gagal dimuat");
      return;
    }

    masterData = data;

    const pclSelect = document.getElementById("pclSelect");
    pclSelect.innerHTML = "<option value=''>-- Pilih PCL --</option>";

    // ambil PCL unik
    const map = {};
    masterData.forEach(d => map[d.id_pcl] = d);

    Object.values(map).forEach(item=>{
      const opt = document.createElement("option");
      opt.value = item.id_pcl;
      opt.textContent = item.nama_pcl;
      pclSelect.appendChild(opt);
    });

  }catch(err){
    console.error(err);
    alert("Gagal load master");
  }
}

// =======================
// SAAT PCL DIPILIH
// =======================
document.getElementById("pclSelect").addEventListener("change", function(){

  const pcl_id = this.value;
  const desaSelect = document.getElementById("desaSelect");
  const bsSelect   = document.getElementById("bsSelect");

  desaSelect.innerHTML = "";
  bsSelect.innerHTML = "";

  masterData
    .filter(m => m.id_pcl === pcl_id)
    .forEach(item => {

      const optDesa = document.createElement("option");
      optDesa.value = item.desa;
      optDesa.textContent = item.desa;
      desaSelect.appendChild(optDesa);

      const optBS = document.createElement("option");
      optBS.value = item.bs;
      optBS.textContent = item.bs;
      bsSelect.appendChild(optBS);

    });
});

document.getElementById("tanggal").valueAsDate = new Date();
loadMaster();
</script>


</body>
</html>




